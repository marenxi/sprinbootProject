<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.springframework.org/schema/mvc">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <script type="text/javascript" src="layui/layui.js"></script>
</head>
<body>
<form class="layui-form" id="findMember"  action="">
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">会员注册日期</label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" class="layui-input" id="startDate">
            </div>
            <div class="layui-form-mid">-</div>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" class="layui-input" id="endDate">
            </div>
        </div>
        <div class="layui-inline">
            <div class="layui-input-inline" style="width: 400px;">
                <input type="text" name="search"  id="name"  placeholder="请输入姓名" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <div class="layui-input-inline" style="width: 80px;">
                <button class="layui-btn" lay-submit lay-filter="formDemo" id="searchMember">查询</button>
            </div>
        </div>
        <div class="layui-inline">
            <div class="layui-input-inline" style="width: 80px;">
                <a class="layui-btn" th:href="@{'/member/add'}" style="text-decoration: none">新增</a>
            </div>
        </div>

    </div>
</form>
<table id="membertable" lay-filter="membertablefilter" align="center"></table>
<!--<table id="membertable1" align="center"></table>-->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">修改</a>
    <a class="layui-btn layui-btn-xs" lay-event="update">审核</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script type="text/javascript" th:inline="javascript">

    //Demo
    layui.use(['layer', 'form', 'element', 'jquery', 'laydate','table'], function () {
        var laydate = layui.laydate;
        var form = layui.form;
        var $ = layui.$;
        //执行一个laydate实例
        laydate.render({
            elem: '#startDate' //指定元素
            ,type:'datetime'
            , done: function (value, date, endDate) {
            }

        });
        laydate.render({
            elem: '#endDate' //指定元素
            ,type:'datetime'
            , done: function (value, date, endDate) {
            }
        });
        //监听提交
        form.on('submit(formDemo)', function (data) {
            layer.msg(JSON.stringify(data.field));
            /*var requestData = $("#findMember").serialize();*/
            var table1=layui.table;

            $.ajax({
                url:"/doMemberListBy",
                type:'post',
                data:
                {
                    "startDate":$("#startDate").val(),
                    "endDate":$("#endDate").val(),
                    "name":$("#name").val(),
                    "age":$("#age").val(),
                    "telephone":$("#telephone").val(),
                    "workType":$("#workType").val(),
                },
                dataType: "json",
                    success: function (data) {
                        //请求成功触发的回调
                        console.log(data.data)
                        table.render({
                            elem: '#membertable'
                            ,height: 465
                            ,data:data.data
                            ,page: true //开启分页
                            ,cols: [[ //表头
                                {field: 'id', title: '序号', width: '10%'},
                                {field: 'name', title: '姓名', width: '10%'},
                                {field: 'age', title: '年龄', width: '10%'},
                                {field: 'workType', title: '工种', width: '10%'},
                                {field: 'telephone', title: '电话', width: '10%'},
                                {field: 'registTime', title: '注册日期', width: '10%'},
                                {field: 'status', title: '状态', width: '10%'},
                                { fixed: 'right', title: '操作', toolbar: '#barDemo', width: '150px' }
                            ]]
                        });
                        if (data.code == 200) {
                            var d = data.data;

                        }else{
                            // errorResult();
                        }
                    },
                    error: function (err) {
                        //请求失败触发的回调
                        console.log(err)
                    }

            });

            return false;
        });

        var table = layui.table;

        //第一个实例,查询出所有的会员并分页显示
        var tableIns= table.render({
            elem: '#membertable'
            ,height: 465
            ,url: '/doMemberListBy' //数据接口
            ,page: true //开启分页
            ,cols: [[ //表头

                {field: 'id', title: '序号', width: '10%'},
                {field: 'name', title: '姓名', width: '10%'},
                {field: 'age', title: '年龄', width: '10%'},
                {field: 'workType', title: '工种', width: '10%'},
                {field: 'telephone', title: '电话', width: '10%'},
                {field: 'registTime', title: '注册日期', width: '10%'},
                {field: 'status', title: '状态', width: '10%'},
                { fixed: 'right', title: '操作', toolbar: '#barDemo', width: '150px' }

            ]]
        });

        //var table1=layui.table;
        //第二个实例，根据时间段及会员的字段列名查询出所有符合条件的记录
        

        tableIns.reload('membertable',{//表格数据的重载
            where: { //设定异步数据接口的额外参数，任意设
               url:'/doMemberListBy'

            }
            ,page: {
                curr: 1 //重新从第 1 页开始
            }
        });

        //监听工具条
        table.on('tool(membertablefilter)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）
            console.log(data);
            if(layEvent === 'detail'){ //查看
                //do somehing
            } else if(layEvent === 'del'){ //删除
                layer.confirm('确认删除行么', function(index){

                    var r=confirm("确认删除该行吗？");
                    if(r){
                        $.ajax({
                            url:"/memberDelete/"+data.id,
                            type:"POST",
                            data:{_method:"DELETE", id:data.id},
                            dataType:"json",
                            success:function(result){
                            }

                        })
;
                    }

                obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
               layer.close(index);
                    //向服务端发送删除指令
                });
            } else if(layEvent === 'edit'){ //编辑
                layer.open({
                    type: 2,
                    area: [($(window).width() * 0.7) + 'px', ($(window).height()* 0.7) + 'px'],
                    fix: false, //不固定
                    maxmin: true,
                    shadeClose: false,
                    shade: 0.4,
                    title: "编辑订单",
                    content: '/updateMember?id='+ data.id,
                    end: function () {
                        $("#queryButton").click();
                    }
                });


            } else if(layEvent === 'LAYTABLE_TIPS'){
                layer.alert('Hi，头部工具栏扩展的右侧图标。');
            }
        });

    });
</script>



</body>
</html>